<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen" />
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print" />

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>ScribeUI - Plugin Creation Tutorial</title>
  </head>
  <body>



<body>
  <div id="wrap">
	<nav id="top-nav" class="inner">
		<a href="index.html" class="active">Home</a> 
		<a href="getting-started.html">Getting Started</a> 
		<a href="documentation.html">Docs</a> 
		<a href="faq.html">FAQ</a> 
		<a href="about.html">About</a> 
	</nav>
  <header>
    <div class="inner">
      <h1>ScribeUI</h1>
      <h2>MapServer Mapfile Development Made Easy</h2>
      <a href="https://github.com/mapgears/scribeui" class="button"><small>View project on</small>GitHub</a>
    </div>
  </header>

<div id="content-wrapper">
  <div class="inner clearfix">
    <section id="main-content">
      <h1>Plugin Creation</h1>

<h2>Getting started</h2>

<p>Let&#39;s create a small Hello World plugin with a few basic functionalities. </p>

<p>All plugins should have their own individual folder in the scribeui_pyramid/modules/plugins directory. </p>

<p>Plugins are simply python modules that take advantage of Pyramid&#39;s <a href="http://docs.pylonsproject.org/docs/pyramid/en/latest/narr/extending.html">extensibility</a>. </p>

<p>As such, you first need an <strong>__init__.py</strong> file. In that file, you have to create a function named <strong>includeme</strong> that receives a <strong>config</strong> object. To have your models and views included automatically, your includeme function should look like this:</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">includeme</span><span class="p">(</span><span class="n">config</span><span class="p">):</span>
    <span class="n">config</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>
</code></pre></div>

<p>And at that point, ScribeUI loads your module without any problems. But it doesn&#39;t do anything yet. </p>

<h2>Adding some new Javascript and CSS to ScribeUI</h2>

<p>If you wish to include static files, adding the following line to the includeme function will add a folder and its subfolder as a route for the application: </p>

<div class="highlight"><pre><code class="python">    <span class="n">config</span><span class="o">.</span><span class="n">add_static_view</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">&#39;hellostatics&#39;</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s">&#39;static&#39;</span><span class="p">)</span>
</code></pre></div>

<p>For our example, let&#39;s create a simple file with the path scribeui_pyramid/modules/plugins/static/js/helloworld.js containing a simple jquery-ui dialog as an example:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">helloDialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;hello-world&quot;&gt;Hello, World!&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">helloDialog</span><span class="p">);</span>
    <span class="nx">helloDialog</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>                                              
        <span class="nx">modal</span><span class="o">:</span><span class="kc">false</span>
    <span class="p">}).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>                                                
<span class="p">})});</span>
</code></pre></div>

<p>This code should be pretty straightforward if you are familiar with jquery-ui.</p>

<p>As ScribeUI is mostly a single page app, if you want css and javascript files to be included directly into the home template, you need to add the  files in a function such this:</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">getIncludedFiles</span><span class="p">():</span>
    <span class="k">return</span> <span class="p">{</span><span class="s">&#39;css&#39;</span><span class="p">:[</span><span class="s">&#39;hellostatics/css/helloworld.css&#39;</span><span class="p">],</span> <span class="c"># if you have any css files</span>
            <span class="s">&#39;js&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;hellostatics/js/helloworld.js&#39;</span><span class="p">]}</span>
</code></pre></div>

<p>The css and js values are arrays so that you may add several javascript and css files to ScribeUI. </p>

<p>And thus, if you restart scribeui ( make restart for the development install, or restarting apache on a production setup), Hello world! should appear in an alert box. </p>

<h2>Server-side functions</h2>

<p>You can easily add models and views to your plugins. Models should be stored in a <strong>models.py</strong> file, and views in <strong>views.py</strong> (or in a folder named views, the mapcache plugin included with ScribeUI is an example of this)</p>

<p>We are going to edit our hello world plugin by formatting a bit of data with templates and getting it with javascript.</p>

<p>First, let&#39;s create a view in <strong>views.py</strong>:</p>

<div class="highlight"><pre><code class="python"><span class="kn">from</span> <span class="nn">pyramid.view</span> <span class="kn">import</span> <span class="n">view_config</span>
<span class="kn">from</span> <span class="nn">pyramid.renderers</span> <span class="kn">import</span> <span class="n">render_to_response</span>

<span class="k">class</span> <span class="nc">HelloWorldView</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request</span> <span class="o">=</span> <span class="n">request</span>

    <span class="nd">@view_config</span><span class="p">(</span>
        <span class="n">route_name</span><span class="o">=</span><span class="s">&#39;helloworld&#39;</span><span class="p">,</span>
        <span class="n">permission</span><span class="o">=</span><span class="s">&#39;view&#39;</span>
    <span class="p">)</span>   
    <span class="k">def</span> <span class="nf">helloworld</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="p">[{</span>
                <span class="s">&quot;language&quot;</span><span class="p">:</span> <span class="s">&quot;English&quot;</span><span class="p">,</span>
                <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;Helloworld&quot;</span>
                <span class="p">},</span>  
                <span class="p">{</span>   
                <span class="s">&quot;language&quot;</span><span class="p">:</span> <span class="s">&quot;French&quot;</span><span class="p">,</span>
                <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;Bonjour monde&quot;</span>
                <span class="p">},</span>  
                <span class="p">{</span>   
                <span class="s">&quot;language&quot;</span><span class="p">:</span> <span class="s">&quot;Spanish&quot;</span><span class="p">,</span>
                <span class="s">&quot;message&quot;</span><span class="p">:</span> <span class="s">&quot;Hola mundo&quot;</span>
                <span class="p">}</span>   
            <span class="p">]</span>   
        <span class="k">return</span> <span class="n">render_to_response</span><span class="p">(</span><span class="s">&#39;scribeui_pyramid:modules/plugins/HelloWorld/templates/helloworld.jinja2&#39;</span><span class="p">,{</span><span class="s">&quot;data&quot;</span><span class="p">:</span><span class="n">data</span><span class="p">})</span>
</code></pre></div>

<p>This code names a route named helloworld, renders it to a template, passing it some data. <a href="http://jinja.pocoo.org/docs/">The templates are using jinja2.</a>, served by <a href="http://docs.pylonsproject.org/projects/pyramid/en/1.0-branch/narr/templates.html">Pyramid templating</a></p>

<p>Let&#39;s create a templates directory, with this basic template, called <strong>helloworld.jinja2</strong>:</p>

<div class="highlight"><pre><code class="html"><span class="nt">&lt;table&gt;&lt;tr&gt;&lt;th&gt;</span>Language<span class="nt">&lt;/th&gt;&lt;th&gt;</span>Message<span class="nt">&lt;/th&gt;&lt;/tr&gt;</span>                     
{% for d in data %}                                                    
    <span class="nt">&lt;tr&gt;&lt;td&gt;</span>{{ d[&#39;language&#39;]  }}<span class="nt">&lt;/td&gt;&lt;td&gt;</span>{{d[&#39;message&#39;]}}<span class="nt">&lt;/td&gt;&lt;/tr&gt;</span>
{% endfor %}                     
<span class="nt">&lt;/table&gt;</span>              
</code></pre></div>

<p>Now, we need to add the route to the config. In __init__.py add the following line to the includeme function:</p>

<div class="highlight"><pre><code class="python"><span class="k">def</span> <span class="nf">getIncludedFiles</span><span class="p">():</span>
   <span class="n">config</span><span class="o">.</span><span class="n">add_route</span><span class="p">(</span><span class="s">&#39;helloworld&#39;</span><span class="p">,</span> <span class="s">&#39;/helloworld&#39;</span><span class="p">)</span>
</code></pre></div>

<p>After restarting ScribeUI, a table containing the data will be accessible at the /helloworld location. </p>

<p>Now, let&#39;s edit our javascript script to show the template in our popup:</p>

<div class="highlight"><pre><code class="javascript"><span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span><span class="nx">url</span><span class="o">:</span><span class="s2">&quot;helloworld&quot;</span><span class="p">,</span><span class="nx">success</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">result</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">helloDialog</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;hello-world&quot;&gt;&#39;</span><span class="o">+</span><span class="nx">result</span><span class="o">+</span><span class="s1">&#39;&lt;/div&gt;&#39;</span><span class="p">);</span>
                <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">helloDialog</span><span class="p">);</span>
                <span class="nx">helloDialog</span><span class="p">.</span><span class="nx">dialog</span><span class="p">({</span>
                        <span class="nx">modal</span><span class="o">:</span><span class="kc">false</span>
                <span class="p">}).</span><span class="nx">dialog</span><span class="p">(</span><span class="s1">&#39;open&#39;</span><span class="p">);</span>
        <span class="p">}});</span>
<span class="p">})});</span>
</code></pre></div>

<p>And now you should see your popup appear when you launch ScribeUI! </p>

<h2>Useful links</h2>

<ul>
<li><a href="http://docs.pylonsproject.org/en/latest/docs/pyramid.html">Pyramid documentation</a></li>
<li><a href="http://jinja.pocoo.org/docs/">Jinja2 Documentation</a></li>
</ul>

    </section>
  </div>
</div>
</div>
<footer>
  <div class="inner clearfix">
    <p>Copyright <a href="http://mapgears.com/">Mapgears</a> 2013 | ScribeUI is released under a <a href="license.html">MIT-style license</a> | ScribeUI.org is hosted on <a href="pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
  </div>
</footer>
</body>
</html>

